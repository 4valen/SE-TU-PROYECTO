{% extends 'fitness/layout.html' %}
{% load static %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="{% static 'fitness/estilos.css' %}">

 <style>

/* --- Ajustes generales de Texto --- */
h1 { font-size: 1.8rem; color: #2c3e50; font-weight: 700; text-align: center; margin-top: 20px; margin-bottom: 10px; }
h2 { font-size: 1.1rem; color: #6c757d; text-align: center; font-weight: 400; margin-bottom: 20px; }
h4 { font-size: 1.3rem; font-weight: 600; }
h5 { font-size: 1.1rem; font-weight: 600; }
p, li { font-size: 0.95rem; line-height: 1.5; }


/* --- Estilos de Im√°genes --- */
.body-type-image { width: 100%; max-width: 250px; height: 180px; object-fit: cover; border-radius: 8px; margin: 10px 0; border: 3px solid #0dcaf0; }
.image-container { text-align: center; margin: 15px 0; }
.image-caption { font-size: 0.85rem; font-style: italic; color: #6c757d; margin-top: 5px; }


/* --- Botones --- */
.btn-with-icon { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem; padding: 8px 16px; }
.btn-icon { width: 18px; height: 18px; }

/* --- Secci√≥n de Rutina --- */
.routine-section { background-color: #f8f9fa; border-radius: 10px; padding: 15px; margin: 15px 0; border-left: 4px solid #0dcaf0; }
.exercise-card { background: white; border-radius: 8px; padding: 12px; margin: 8px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.exercise-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.exercise-name { font-weight: 600; color: #2c3e50; font-size: 0.95rem; }
.exercise-sets { background: #0dcaf0; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; }
.download-btn { background: linear-gradient(135deg, #0dcaf0, #0da2c2); color: white; border: none; padding: 8px 20px; border-radius: 25px; font-weight: bold; font-size: 0.9rem; transition: all 0.3s ease; }
.download-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(13, 202, 240, 0.3); }


/* --- Pesta√±as --- */
.day-tab { cursor: pointer; padding: 8px 16px; border-radius: 20px; margin: 4px; font-size: 0.9rem; background: #e9ecef; border: none; transition: all 0.3s ease; }
.day-tab.active { background: #0dcaf0; color: white; }
.training-day { display: none; }
.training-day.active { display: block; }
.modal-title { font-size: 1.2rem; font-weight: bold; }
</style> 

<form id="miFormulario" method="post" action="{% url 'generacion' %}">
    {% csrf_token %}
</form>

<h1>Selecciona tu rutina seg√∫n tu tipo de cuerpo</h1>
<h2>Aqu√≠ una imagen de referencia</h2>

<img src="{% static 'fitness/img/tip.png' %}" 
     alt="Referencia Tipos de Cuerpo" 
     class="img-fluid d-block mx-auto mb-4"
     width="300" 
     height="200"> 

<div class="d-flex gap-3 flex-wrap mb-4 justify-content-center">
    <button type="button" class="btn btn-info btn-with-icon" 
            data-bs-toggle="modal" data-bs-target="#modalEctomorfo">
        <img src="{% static 'fitness/img/boton.png' %}" class="btn-icon">
        Ectomorfo
    </button>
    
    <button type="button" class="btn btn-info btn-with-icon" 
            data-bs-toggle="modal" data-bs-target="#modalMesomorfo">
        <img src="{% static 'fitness/img/boton.png' %}" class="btn-icon">
        Mesomorfo
    </button>
    
    <button type="button" class="btn btn-info btn-with-icon" 
            data-bs-toggle="modal" data-bs-target="#modalEndomorfo">
        <img src="{% static 'fitness/img/boton.png' %}" class="btn-icon">
        Endomorfo
    </button>
</div>

<div id="rutinaContainer" class="mt-4" style="display: none;">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 id="routineTitle" class="mb-0">Tu Rutina Personalizada</h4>
        </div>
        <div class="card-body">
            <div id="routineContent"></div>
            <div class="text-center mt-3">
                <button id="downloadRoutine" class="download-btn btn btn-success">üì• Descargar Rutina</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEctomorfo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tipo Ectomorfo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="image-container">
                    <img src="{% static 'fitness/img/dieta_para_ectomorfo-2690867088.jpg' %}" class="body-type-image"> 
                    <div class="image-caption">Complexi√≥n delgada y estilizada</div>
                </div>
                <h4>¬°Hola! Eres de tipo Ectomorfo</h4>
                <p>Caracter√≠sticas: Dificultad para ganar peso, metabolismo r√°pido.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="generarRutina('ectomorfo')">Generar Rutina</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalMesomorfo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tipo Mesomorfo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="image-container">
                    <img src="{% static 'fitness/img/Cuerpo Mesomorfo.png' %}" class="body-type-image">
                    <div class="image-caption">Complexi√≥n atl√©tica</div>
                </div>
                <h4>¬°Hola! Eres de tipo Mesomorfo</h4>
                <p>Caracter√≠sticas: Facilidad para ganar m√∫sculo, cuerpo atl√©tico.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="generarRutina('mesomorfo')">Generar Rutina</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEndomorfo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tipo Endomorfo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="image-container">
                    <img src="{% static 'fitness/img/Persona-cuerpo-endomorfo.jpg' %}" class="body-type-image">
                    <div class="image-caption">Complexi√≥n redondeada</div>
                </div>
                <h4>¬°Hola! Eres de tipo Endomorfo</h4>
                <p>Caracter√≠sticas: Facilidad para ganar peso, metabolismo lento.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="generarRutina('endomorfo')">Generar Rutina</button>
            </div>
        </div>
    </div>
</div>

<script>
    // DATOS DE LAS RUTINAS CON VIDEOS
    // Aqu√≠ es donde defines qu√© video sale en cada ejercicio
    const rutinas = {
        ectomorfo: {
            titulo: "Rutina Ectomorfo - Ganar Masa",
            descripcion: "Rutina de volumen con descansos largos.",
            frecuencia: "4 d√≠as por semana",
            dias: [
                {
                    nombre: "D√≠a 1: Pecho y Tr√≠ceps",
                    ejercicios: [
                        { 
                            nombre: "Press de Banca", 
                            series: "4 Series x 8 Reps", 
                            desc: "Acu√©state en el banco. Baja la barra hasta tocar el pecho medio y sube explosivamente. Mant√©n los codos a 45 grados.",
                            video: "https://www.youtube.com/embed/TAH8RxOS0VI?si=h0e0lK5qIQtxVTeu" 
                        },
                        { 
                            nombre: "Press Inclinado con Mancuernas", 
                            series: "3 Series x 10 Reps", 
                            desc: "Banco inclinado a 30¬∞. Sube las mancuernas junt√°ndolas arriba sin chocarlas.",
                            video: "https://www.youtube.com/embed/TAH8RxOS0VI?si=h0e0lK5qIQtxVTeu" 
                        },
                        { 
                            nombre: "Aperturas", 
                            series: "3 Series x 12 Reps", 
                            desc: "Abre los brazos como si fueras a abrazar un √°rbol grande. Siente el estiramiento en el pecho.",
                            video: "https://www.youtube.com/embed/TAH8RxOS0VI?si=h0e0lK5qIQtxVTeu" 
                        },
                        { 
                            nombre: "Fondos (Dips)", 
                            series: "3 Series x 10 Reps",
                            desc: "Baja el cuerpo doblando los codos hasta 90 grados. Incl√≠nate hacia adelante para enfocar el pecho.",
                            video: "https://www.youtube.com/embed/TAH8RxOS0VI?si=h0e0lK5qIQtxVTeu"
                        }
                    ]
                },
                {
                    nombre: "D√≠a 2: Espalda y B√≠ceps",
                    ejercicios: [
                        { nombre: "Dominadas", series: "4 x 8", desc: "Sube hasta pasar la barbilla.", video: "https://www.youtube.com/embed/eGo4IYlbE5g" },
                        { nombre: "Remo con Barra", series: "3 x 8", desc: "Espalda recta, tira la barra al ombligo.", video: "https://www.youtube.com/embed/9efgcAjQe7E" },
                        { nombre: "Curl de B√≠ceps", series: "3 x 10", desc: "No muevas los codos del costado.", video: "https://www.youtube.com/embed/ykJmrZ5v0Oo" }
                    ]
                },
                
                {
                    nombre: "D√≠a 3: Piernas",
                    ejercicios: [
                        { nombre: "Sentadillas", series: "4 x 8" },
                        { nombre: "Prensa", series: "3 x 10" }
                    ]
                }
            ]
        },
        mesomorfo: {
            titulo: "Rutina Mesomorfo - Hipertrofia",
            descripcion: "Intensidad moderada-alta.",
            frecuencia: "5 d√≠as",
            dias: [
                {
                    nombre: "D√≠a 1: Pecho",
                    ejercicios: [
                        { nombre: "Press Banca", series: "4 x 6", video: "https://www.youtube.com/embed/vthMCtgGtFc" },
                        { nombre: "Aperturas", series: "3 x 12" }
                    ]
                }
                
            ]
        },
        endomorfo: {
            titulo: "Rutina Endomorfo - Quema Grasa",
            descripcion: "Alto ritmo card√≠aco.",
            frecuencia: "5 d√≠as",
            dias: [
                {
                    nombre: "D√≠a 1: Circuito",
                    ejercicios: [
                        { nombre: "Burpees", series: "3 x 15", desc: "Pecho al suelo y salto.", video: "https://www.youtube.com/embed/auBLPXO8Fww" },
                        { nombre: "Sentadillas", series: "4 x 15" }
                    ]
                }
                
            ]
        }
    };

    function generarRutina(tipoCuerpo) {
        const rutina = rutinas[tipoCuerpo];
        const container = document.getElementById('rutinaContainer');
        const content = document.getElementById('routineContent');

        // Cerrar modal
        const modalElement = document.getElementById('modal' + tipoCuerpo.charAt(0).toUpperCase() + tipoCuerpo.slice(1));
        const modal = bootstrap.Modal.getInstance(modalElement);
        if(modal) modal.hide();

        document.getElementById('routineTitle').textContent = rutina.titulo;

        let html = `
            <div class="routine-section">
                <h5>üìã Descripci√≥n General</h5>
                <p>${rutinas[tipoCuerpo].descripcion}</p>
                <p><strong>Frecuencia:</strong> ${rutinas[tipoCuerpo].frecuencia}</p>
            </div>
            
            <div class="mb-3 d-flex flex-wrap">`;
            
        rutina.dias.forEach((dia, index) => {
            html += `<button class="day-tab ${index===0?'active':''}" onclick="cambiarDia(${index})">${dia.nombre.split(':')[0]}</button>`;
        });
        
        html += `</div>`;

        rutina.dias.forEach((dia, index) => {
            html += `<div class="training-day ${index===0?'active':''}" id="day${index}">
                <h5 class="text-primary mb-3">${dia.nombre}</h5>
                <div class="row">`;
            
            dia.ejercicios.forEach(ej => {
                // Aqu√≠ verificamos si hay video
                const tieneVideo = ej.video ? true : false;
                const descripcion = ej.desc ? ej.desc : "Realiza el ejercicio con t√©cnica cuidada.";
                
                html += `
                <div class="col-md-6">
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <span class="exercise-name">${ej.nombre}</span>
                            <span class="exercise-sets">${ej.series}</span>
                        </div>
                        
                        <details>
                            <summary>üé• Ver c√≥mo se hace</summary>
                            <div class="mt-2">
                                <p class="video-desc">${descripcion}</p>
                                ${tieneVideo ? `
                                <div class="ratio ratio-16x9">
                                    <iframe src="${ej.video}" allowfullscreen style="border-radius:6px;"></iframe>
                                </div>` : '<p class="text-muted small">Video no disponible</p>'}
                            </div>
                        </details>
                        
                    </div>
                </div>`;
            });
            html += `</div></div>`;
        });

        content.innerHTML = html;
        container.style.display = 'block';
        container.scrollIntoView({behavior: 'smooth'});
    }

    function cambiarDia(index) {
        document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.training-day').forEach(d => d.classList.remove('active'));
        document.querySelectorAll('.day-tab')[index].classList.add('active');
        document.getElementById('day'+index).classList.add('active');
    }

    // Inicializar tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
{% endblock %}